import{s as he,a as $,b as we,e as fe,i as pe,c as qe,r as ye,p as Ie}from"../chunks/dMqFn7jp.js";import{b as xe,e as Fe,t as I,a as P}from"../chunks/DFnnfvOT.js";import{i as ee}from"../chunks/DYNYGpMI.js";import{T as M,h as ve,a as Se,a4 as Ee,aH as Ue,g as je,al as Me,aA as Ne,az as Re,s as Le,a2 as le,R as te,aI as me,N as de,aJ as ge,W as v,X as l,Y as g,V as ae,q as e,C as U,v as S,o as H,j as Ye,a0 as ke,aK as ce}from"../chunks/CP9iBIY3.js";import{r as Te,s as A,e as ue}from"../chunks/C1rsFGU6.js";import{i as D}from"../chunks/DyaG4xHv.js";import{p as _}from"../chunks/CxxjM-MP.js";import{c as ze,o as Qe,a as We}from"../chunks/Bx7R3Y1A.js";function De(b,n,s=!1,a=!1,u=!1){var t=b,r="";M(()=>{var i=Ee;if(r===(r=n()??"")){ve&&Se();return}if(i.nodes_start!==null&&(Ue(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),r!==""){if(ve){je.data;for(var o=Se(),m=o;o!==null&&(o.nodeType!==8||o.data!=="");)m=o,o=Me(o);if(o===null)throw Ne(),Re;xe(je,m),t=Le(o);return}var c=r+"";s?c=`<svg>${c}</svg>`:a&&(c=`<math>${c}</math>`);var d=Fe(c);if((s||a)&&(d=le(d)),xe(le(d),d.lastChild),s||a)for(;le(d);)t.before(le(d));else t.before(d)}})}const Oe=[...` 	
\r\fÂ \v\uFEFF`];function He(b,n,s){var a=""+b;if(s){for(var u in s)if(s[u])a=a?a+" "+u:u;else if(a.length)for(var t=u.length,r=0;(r=a.indexOf(u,r))>=0;){var i=r+t;(r===0||Oe.includes(a[r-1]))&&(i===a.length||Oe.includes(a[i]))?a=(r===0?"":a.substring(0,r))+a.substring(i+1):r=i}}return a===""?null:a}function Je(b,n,s,a,u,t){var r=b.__className;if(ve||r!==s||r===void 0){var i=He(s,a,t);(!ve||i!==b.getAttribute("class"))&&(i==null?b.removeAttribute("class"):b.className=i),b.__className=s}else if(t&&u!==t)for(var o in t){var m=!!t[o];(u==null||m!==!!u[o])&&b.classList.toggle(o,m)}return t}const Be=({url:b})=>{const n=b.searchParams.get("time"),s=n?parseInt(n,10):40,a=b.searchParams.get("set"),u=a?parseInt(a,10):0,t=u>=0&&u<he.length?u:0;return{selectedSet:he[t],timeInMinutes:s,setIndex:t}},qt=Object.freeze(Object.defineProperty({__proto__:null,load:Be},Symbol.toStringTag,{value:"Module"}));var Ge=I('<div class="feedback svelte-l1nj25"><h3 class="svelte-l1nj25">Feedback:</h3> <p class="svelte-l1nj25"><!></p> <div class="followup-chat svelte-l1nj25"><textarea placeholder="Ask a follow-up question..." rows="2" class="svelte-l1nj25"></textarea> <button type="button" class="primary-button svelte-l1nj25"> </button></div></div>'),Ke=I('<div class="debug-info" style="display: none;"><p> </p></div>'),Ve=I('<div class="answer-section svelte-l1nj25"><label class="svelte-l1nj25"><strong> </strong> </label> <textarea rows="4" class="svelte-l1nj25"></textarea> <!></div>');function Ce(b,n){te(n,!1);let s=_(n,"question",8),a=_(n,"letter",8),u=_(n,"answer",12),t=_(n,"feedback",12),r=_(n,"disabled",8,!1),i=U(""),o=U(!1);const m=ze();Qe(()=>{console.log(`QuestionSection mounted for letter ${a()}, question: ${s().substring(0,30)}...`)});async function c(){var h;if((h=e(i))!=null&&h.trim()){S(o,!0);try{const f=await fetch("/api/grade/followup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:s(),originalAnswer:u(),previousFeedback:t(),followupQuestion:e(i)})});if(!f.ok)throw new Error("Failed to get followup response");const y=await f.json(),O=t()+`

<span class="chat-label">You:</span> `+e(i)+`

<span class="chat-label">Tutor:</span> `+y.response;m("updateFeedback",O),t(O),S(i,"")}catch(f){console.error("Error sending followup:",f)}finally{S(o,!1)}}}me(()=>(de(t()),de(a())),()=>{t()&&console.log(`Feedback received for question ${a()}:`,t())}),ge(),ee();var d=Ve(),w=v(d),k=v(w),Q=v(k);l(k);var q=g(k);l(w);var T=g(w,2);Te(T);var j=g(T,2);{var Y=h=>{var f=Ge(),y=g(v(f),2),O=v(y);De(O,t),l(y);var x=g(y,2),F=v(x);Te(F);var R=g(F,2),J=v(R,!0);l(R),l(x),l(f),M(()=>{R.disabled=e(o),A(J,e(o)?"Sending...":"Send")}),we(F,()=>e(i),E=>S(i,E)),ue("click",R,c),P(h,f)},N=h=>{var f=Ke(),y=v(f),O=v(y);l(y),l(f),M(x=>A(O,`No feedback available. Letter: ${a()??""}, Question: ${x??""}...`),[()=>s().substring(0,20)],H),P(h,f)};D(j,h=>{t()?h(Y):h(N,!1)})}l(d),M(()=>{$(w,"for",`part-${a()??""}`),A(Q,`${a()??""})`),A(q,` ${s()??""}`),$(T,"id",`part-${a()??""}`),$(T,"placeholder",`Enter your response for part (${a()??""})...`),T.disabled=r()}),we(T,u),P(b,d),ae()}var Xe=I('<div class="text-context svelte-153p5lt"><p class="context-content svelte-153p5lt"> </p> <p class="context-source svelte-153p5lt"> </p></div>'),Ze=I('<p class="context-description svelte-153p5lt"> </p>'),$e=I('<p class="context-caption svelte-153p5lt"> </p>'),et=I('<div class="image-context svelte-153p5lt"><h3 class="svelte-153p5lt"> </h3> <!> <div class="image-container svelte-153p5lt"><img class="svelte-153p5lt"></div> <p class="context-citation svelte-153p5lt"> </p> <!></div>'),tt=I('<div class="context-section svelte-153p5lt"><!></div>'),at=I('<div class="saq-question svelte-153p5lt"><h2 class="svelte-153p5lt"> </h2> <!> <div class="parts-section svelte-153p5lt"></div></div>');function st(b,n){te(n,!1);let s=_(n,"saq",8),a=_(n,"saqIndex",8),u=_(n,"answers",12),t=_(n,"feedback",12),r=_(n,"isTimeUp",8),i=_(n,"isSubmitted",8);const o=q=>String.fromCharCode(97+q);ee();var m=at(),c=v(m),d=v(c);l(c);var w=g(c,2);{var k=q=>{var T=tt(),j=v(T);{var Y=h=>{var f=Xe(),y=v(f),O=v(y,!0);l(y);var x=g(y,2),F=v(x);l(x),l(f),M(()=>{A(O,s().context.content),A(F,`Source: ${s().context.source??""}`)}),P(h,f)},N=(h,f)=>{{var y=O=>{var x=et(),F=v(x),R=v(F,!0);l(F);var J=g(F,2);{var E=L=>{var W=Ze(),p=v(W,!0);l(W),M(()=>A(p,s().context.description)),P(L,W)};D(J,L=>{s().context.description&&L(E)})}var z=g(J,2),V=v(z);l(z);var X=g(z,2),Z=v(X);l(X);var se=g(X,2);{var ne=L=>{var W=$e(),p=v(W,!0);l(W),M(()=>A(p,s().context.caption)),P(L,W)};D(se,L=>{s().context.caption&&L(ne)})}l(x),M(()=>{A(R,s().context.title),$(V,"src",s().context.imageUrl),$(V,"alt",s().context.title),A(Z,`Citation: ${s().context.citation??""}`)}),P(O,x)};D(h,O=>{s().context.type==="image"&&O(y)},f)}};D(j,h=>{s().context.type==="text"?h(Y):h(N,!1)})}l(T),P(q,T)};D(w,q=>{s().context&&q(k)})}var Q=g(w,2);fe(Q,5,()=>s().parts,pe,(q,T,j)=>{const Y=H(()=>o(j)),N=H(()=>{var f;return(f=t()[a().toString()])==null?void 0:f[o(j)]}),h=H(()=>r()||i());Ce(q,{get question(){return e(T)},get letter(){return e(Y)},get feedback(){return e(N)},get disabled(){return e(h)},get answer(){return u()[a().toString()][o(j)]},set answer(f){u(u()[a().toString()][o(j)]=f,!0)},$$events:{updateFeedback:f=>{t()[a().toString()]||t(t()[a().toString()]={},!0),t(t()[a().toString()][o(j)]=f.detail,!0)}},$$legacy:!0})}),l(Q),l(m),M(()=>A(d,`Short Answer Question ${a()+1}`)),P(b,m),ae()}var nt=I('<div class="optional-question-selector svelte-ev87pm"><h2 class="svelte-ev87pm">Choose one of the following questions:</h2> <div class="radio-group svelte-ev87pm"><label class="radio-label svelte-ev87pm"><input type="radio" name="optionalQuestion" class="svelte-ev87pm"> Question 3</label> <label class="radio-label svelte-ev87pm"><input type="radio" name="optionalQuestion" class="svelte-ev87pm"> Question 4</label></div></div> <div class="saq-question svelte-ev87pm"><h2 class="svelte-ev87pm"> </h2> <div class="parts-section svelte-ev87pm"></div></div>',1);function rt(b,n){te(n,!1);const s=[];let a=_(n,"question3",8),u=_(n,"question4",8),t=_(n,"selectedOptionalQuestion",12),r=_(n,"answers",12),i=_(n,"feedback",12),o=_(n,"isTimeUp",8),m=_(n,"isSubmitted",8);const c=y=>String.fromCharCode(97+y);ee();var d=nt(),w=Ye(d),k=g(v(w),2),Q=v(k),q=v(Q);ye(q),q.value=q.__value=3,ke(),l(Q);var T=g(Q,2),j=v(T);ye(j),j.value=j.__value=4,ke(),l(T),l(k),l(w);var Y=g(w,2),N=v(Y),h=v(N);l(N);var f=g(N,2);fe(f,5,()=>(t()===3?a():u()).parts,pe,(y,O,x)=>{const F=H(()=>c(x)),R=H(()=>{var E;return(E=i()[t()===3?"2":"3"])==null?void 0:E[c(x)]}),J=H(()=>o()||m());Ce(y,{get question(){return e(O)},get letter(){return e(F)},get feedback(){return e(R)},get disabled(){return e(J)},get answer(){return r()[t()===3?"2":"3"][c(x)]},set answer(E){r(r()[t()===3?"2":"3"][c(x)]=E,!0)},$$events:{updateFeedback:E=>{const z=t()===3?"2":"3";i()[z]||i(i()[z]={},!0),i(i()[z][c(x)]=E.detail,!0)}},$$legacy:!0})}),l(f),l(Y),M(()=>{q.disabled=m()||o(),j.disabled=m()||o(),A(h,`Short Answer Question ${t()??""}`)}),qe(s,[],q,()=>t(),t),qe(s,[],j,()=>t(),t),P(b,d),ae()}var it=I("<div> </div>");function ot(b,n){te(n,!1);let s=_(n,"onTimeUp",8),a=_(n,"timeInMinutes",8,15),u=_(n,"frozen",8,!1),t=U(a()*60),r=U();function i(d){const w=Math.floor(d/60),k=d%60;return`${w}:${k.toString().padStart(2,"0")}`}Qe(()=>{S(r,setInterval(()=>{u()||(S(t,e(t)-1),e(t)<=0&&(clearInterval(e(r)),s()()))},1e3))}),We(()=>{e(r)&&clearInterval(e(r))}),me(()=>(de(u()),e(r)),()=>{u()&&e(r)&&clearInterval(e(r))}),ge(),ee();var o=it();let m;var c=v(o);l(o),M((d,w)=>{m=Je(o,1,"timer svelte-l6uf2j",null,m,d),A(c,`Time Remaining: ${w??""}`)},[()=>({warning:e(t)<=60&&!u()}),()=>i(e(t))],H),P(b,o),ae()}var lt=I('<div class="warning-modal svelte-18a8j4q"><div class="warning-content svelte-18a8j4q"><h2 class="svelte-18a8j4q">Warning</h2> <p>You have unanswered questions. Are you sure you want to submit?</p> <div class="warning-buttons svelte-18a8j4q"><button class="secondary svelte-18a8j4q">Go Back</button> <button class="primary svelte-18a8j4q">Submit Anyway</button></div></div></div>');function ct(b,n){let s=_(n,"onClose",8),a=_(n,"onProceed",8);var u=lt(),t=v(u),r=g(v(t),4),i=v(r),o=g(i,2);l(r),l(t),l(u),ue("click",i,function(...m){var c;(c=s())==null||c.apply(this,m)}),ue("click",o,function(...m){var c;(c=a())==null||c.apply(this,m)}),P(b,u)}var vt=I(`<div class="time-up-banner svelte-1jnl9ql">Time's up! Your answers have been submitted automatically.</div>`),ut=I('<div class="submitted-banner svelte-1jnl9ql">Your answers have been submitted successfully.</div>'),dt=I('<main class="svelte-1jnl9ql"><!> <h1 class="svelte-1jnl9ql"> </h1> <!> <!> <!> <form><!> <!> <button type="submit" class="svelte-1jnl9ql"> </button></form></main>');function yt(b,n){te(n,!1);const s=U();let a=_(n,"data",8);const u=p=>String.fromCharCode(97+p),t=a().selectedSet,r=t.questions.slice(0,2),i=t.questions[2],o=t.questions[3];let m=U(3),c=U({});t.questions.forEach((p,C)=>{ce(c,e(c)[C]={}),p.parts.forEach((re,B)=>{ce(c,e(c)[C][u(B)]="")})});let d=U({}),w=U(!1),k=U(!1),Q=U(!1),q=U(!1);function T(){return Object.values(e(c)).some(p=>Object.values(p).some(C=>!C.trim()))}async function j(p=!1){if(!e(w)){if(!p&&T()&&!e(q)){S(q,!0);return}S(q,!1),S(w,!0);try{const C=[],re=["0","1",e(m)===3?"2":"3"];Object.entries(e(c)).forEach(([K,ie])=>{if(!re.includes(K))return;let G=Number(K);G>1&&(G=2);const oe=e(s)[G];Object.entries(ie).forEach(([_e,Ae])=>{const Pe=_e.charCodeAt(0)-97;C.push({saqIndex:K,letter:_e,question:oe.parts[Pe],answer:Ae})})});const B=await fetch("/api/grade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:C})});if(!B.ok)throw new Error("Failed to grade answers");const be=await B.json();console.log("Received feedback:",be),Object.entries(be).forEach(([K,ie])=>{console.log("Processing feedback key:",K,"value:",ie);const[G,oe]=K.split("-");console.log("Parsed saqIndex:",G,"letter:",oe),e(d)[G]||ce(d,e(d)[G]={}),ce(d,e(d)[G][oe]=ie)}),console.log("Final feedback object:",e(d)),S(Q,!0)}catch(C){console.error("Error grading answers:",C),S(d,{0:{a:"Failed to grade answers. Please try again."}})}finally{S(w,!1)}}}async function Y(){S(k,!0),await j()}function N(){j(!0)}function h(){S(q,!1)}me(()=>e(m),()=>{S(s,[...r,e(m)===3?i:o])}),ge(),ee();var f=dt(),y=v(f);const O=H(()=>e(k)||e(Q));ot(y,{onTimeUp:Y,get timeInMinutes(){return a().timeInMinutes},get frozen(){return e(O)}});var x=g(y,2),F=v(x);l(x);var R=g(x,2);{var J=p=>{var C=vt();P(p,C)};D(R,p=>{e(k)&&p(J)})}var E=g(R,2);{var z=p=>{var C=ut();P(p,C)};D(E,p=>{e(Q)&&!e(k)&&p(z)})}var V=g(E,2);{var X=p=>{ct(p,{onClose:h,onProceed:N})};D(V,p=>{e(q)&&p(X)})}var Z=g(V,2),se=v(Z);fe(se,1,()=>e(s).slice(0,2),pe,(p,C,re)=>{st(p,{get saq(){return e(C)},saqIndex:re,get isTimeUp(){return e(k)},get isSubmitted(){return e(Q)},get answers(){return e(c)},set answers(B){S(c,B)},get feedback(){return e(d)},set feedback(B){S(d,B)},$$legacy:!0})});var ne=g(se,2);rt(ne,{question3:i,question4:o,get isTimeUp(){return e(k)},get isSubmitted(){return e(Q)},get selectedOptionalQuestion(){return e(m)},set selectedOptionalQuestion(p){S(m,p)},get answers(){return e(c)},set answers(p){S(c,p)},get feedback(){return e(d)},set feedback(p){S(d,p)},$$legacy:!0});var L=g(ne,2),W=v(L,!0);l(L),l(Z),l(f),M(()=>{A(F,`AP World History: ${t.label??""} (${a().timeInMinutes??""} minutes)`),L.disabled=e(w)||e(k)||e(Q),A(W,e(w)?"Grading...":"Submit Answers")}),ue("submit",Z,Ie(()=>j())),P(b,f),ae()}export{yt as component,qt as universal};
